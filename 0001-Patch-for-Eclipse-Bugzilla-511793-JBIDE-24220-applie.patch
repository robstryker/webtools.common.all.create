From ba866eead19dc1512f1483f4901361029179d62b Mon Sep 17 00:00:00 2001
From: nickboldt <nboldt@redhat.com>
Date: Tue, 18 Apr 2017 12:17:07 -0400
Subject: [PATCH] Patch for Eclipse Bugzilla 511793 / JBIDE-24220 applied in
 master branch of webtools.common.all fork

Signed-off-by: nickboldt <nboldt@redhat.com>
---
 .../internal/util/ComponentImplManager.java           | 19 +++++++++----------
 1 file changed, 9 insertions(+), 10 deletions(-)

diff --git a/webtools.common/plugins/org.eclipse.wst.common.modulecore/modulecore-src/org/eclipse/wst/common/componentcore/internal/util/ComponentImplManager.java b/webtools.common/plugins/org.eclipse.wst.common.modulecore/modulecore-src/org/eclipse/wst/common/componentcore/internal/util/ComponentImplManager.java
index 422e468..283613a 100644
--- a/webtools.common/plugins/org.eclipse.wst.common.modulecore/modulecore-src/org/eclipse/wst/common/componentcore/internal/util/ComponentImplManager.java
+++ b/webtools.common/plugins/org.eclipse.wst.common.modulecore/modulecore-src/org/eclipse/wst/common/componentcore/internal/util/ComponentImplManager.java
@@ -202,23 +202,24 @@ public class ComponentImplManager implements ISynchronizerExtender{
 	}
 
 	public IVirtualComponent createComponent(IProject project) {
-		IVirtualComponent retVal = null;
-		// acquire the lock that StructureEdit will need already, to prevent others from locking that before calling createComponent() - see bug 508685
+		return createComponent(project, true);
+	}
+
+	public IVirtualComponent createComponent(IProject project, boolean checkSettings) {
 		ILock lock = EMFWorkbenchEditContextFactory.getProjectLockObject(project);
 		try{
 			if(null != lock){
 				lock.acquire();
 			}
-			retVal = createComponent(project, true);
+			return createComponentSynchronously(project, checkSettings);
 		} finally{
 			if(null != lock){
 				lock.release();
 			}
 		}
-		return retVal;
 	}
 
-	public synchronized IVirtualComponent createComponent(IProject project, boolean checkSettings) {
+	private synchronized IVirtualComponent createComponentSynchronously(IProject project, boolean checkSettings) {
 		try {
 			IVirtualComponent component = ComponentCacheManager.instance().getComponent(project);
 			if(component != null) {
@@ -248,11 +249,9 @@ public class ComponentImplManager implements ISynchronizerExtender{
 			}
 		}
 		IVirtualComponent component = new VirtualComponent(project, new Path("/")); //$NON-NLS-1$
-		if(component != null) {
-			ComponentCacheManager.instance().setComponentImplFactory(project, null);
-			ComponentCacheManager.instance().setComponent(project, component);
-			registerListener(project);
-		}
+		ComponentCacheManager.instance().setComponentImplFactory(project, null);
+		ComponentCacheManager.instance().setComponent(project, component);
+		registerListener(project);
 
 		return component;
 	}
-- 
2.7.4

